<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Conversational H.E.A.R.T. Assessment</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #000;        /* black background for ‚Äúbolt.‚Äù brand */
      color: #FFF;                   /* white text */
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      background: #111;              /* slightly off-black container */
      border-radius: 8px;
      box-shadow: 0 0 16px rgba(0,0,0,0.4);
      padding: 24px;
      margin: 40px;
      width: 100%;
      max-width: 480px;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 16px;
      text-align: center;
      color: #00AEEF;                /* bolt.-blue tagline color */
    }
    .logo {
      display: block;
      margin: 0 auto 16px auto;
      width: 120px;
      height: auto;
    }
    .chat-window {
      background: #222;              /* dark gray chat background */
      border-radius: 6px;
      padding: 16px;
      min-height: 320px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
    }
    .bubble {
      padding: 10px 14px;
      border-radius: 20px;
      max-width: 80%;
      font-size: 14px;
      line-height: 1.4;
      word-wrap: break-word;
    }
    .bot {
      background: #333;              /* darker bubble for bot */
      align-self: flex-start;
      color: #EEE;
    }
    .user {
      background: #005B9A;           /* bolt. navy-blue bubble for user */
      align-self: flex-end;
      color: #FFF;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .option-btn {
      border: none;
      padding: 8px 12px;
      border-radius: 20px;
      cursor: pointer;
      background: #005B9A;           /* bolt. navy-blue buttons */
      color: #FFF;
      font-size: 14px;
    }
    .option-btn:hover {
      background: #00AEEF;           /* bolt. bright-blue hover */
    }
    #loading {
      display: none;
      margin-top: 10px;
      font-style: italic;
      color: #BBB;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 1) The brand logo at the top -->
    <img
      src="/static/images/bolt_logo_white.png"
      alt="bolt. logo"
      class="logo"
    />

    <h1>Conversational H.E.A.R.T. Assessment</h1>

    <!-- 2) Chat window -->
    <div class="chat-window" id="chatWindow">
      <!-- Chat bubbles will be injected here -->
    </div>
    <div id="loading">Calculating your H.E.A.R.T. scores‚Ä¶</div>
  </div>

  <script>
    // ‚îÄ‚îÄ‚îÄ 1) The four questions & their emoji choices ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const questions = [
      {
        key: "work_feeling",
        text: "Which emoji best captures how you feel about your work right now?",
        options: [
          "üòÄ Energized",
          "üôÇ Okay",
          "üòê Meh",
          "üòì Drained",
          "üò° Frustrated"
        ]
      },
      {
        key: "team_feeling",
        text: "Which emoji best captures how you feel about your team?",
        options: [
          "ü§ù Supported",
          "üòî Alone",
          "üëÇ Heard",
          "‚ùå Dismissed",
          "üîí Safe",
          "ü§® Judged",
          "üôå Encouraged",
          "üí° Valued"
        ]
      },
      {
        key: "leadership_feeling",
        text: "Which emoji best captures how you feel about leadership?",
        options: [
          "üîä Clear",
          "üôÅ Distant",
          "üéØ Trustworthy",
          "‚òÅÔ∏è Unclear",
          "‚ú® Inspiring",
          "ü§® Rigid",
          "üòì Micromanaging",
          "üîí Safe"
        ]
      },
      {
        key: "company_people_feeling",
        text: "Which emoji best captures how you feel about people at your company?",
        options: [
          "ü§ó Included",
          "üòí Ignored",
          "‚ù§Ô∏è Connected",
          "ü§ù Respectful",
          "ü§î Suspicious",
          "üö™ Excluded",
          "üîí Safe",
          "üòì Isolated"
        ]
      }
    ];

    // We‚Äôll store each answer here:
    const answers = {};

    // Index of the question we are currently on:
    let currentQuestionIndex = 0;

    const chatWindow = document.getElementById("chatWindow");
    const loadingIndicator = document.getElementById("loading");

    // ‚îÄ‚îÄ‚îÄ Utility: Add a ‚Äúbot‚Äù bubble with some text ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function addBotBubble(text) {
      const bubble = document.createElement("div");
      bubble.className = "bubble bot";
      bubble.innerText = text;
      chatWindow.appendChild(bubble);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // ‚îÄ‚îÄ‚îÄ Utility: Add a ‚Äúuser‚Äù bubble with the chosen answer ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function addUserBubble(text) {
      const bubble = document.createElement("div");
      bubble.className = "bubble user";
      bubble.innerText = text;
      chatWindow.appendChild(bubble);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // ‚îÄ‚îÄ‚îÄ Utility: Render the emoji‚Äêoptions buttons for the current question ‚îÄ
    function renderOptions(options, questionKey) {
      const container = document.createElement("div");
      container.className = "options";

      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "option-btn";
        btn.innerText = opt;
        btn.onclick = () => handleUserChoice(questionKey, opt);
        container.appendChild(btn);
      });

      chatWindow.appendChild(container);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // ‚îÄ‚îÄ‚îÄ Handler when user picks one option ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function handleUserChoice(questionKey, chosenText) {
      // 1) Remove all existing option buttons (so user can‚Äôt click again)
      document.querySelectorAll(".options").forEach(el => el.remove());

      // 2) Show the user‚Äôs choice as a user‚Äêbubble
      addUserBubble(chosenText);

      // 3) Store it
      answers[questionKey] = chosenText;

      // 4) Move to the next question after a short delay:
      currentQuestionIndex++;
      if (currentQuestionIndex < questions.length) {
        setTimeout(renderNextQuestion, 400);
      } else {
        // All four answered; now call the backend for H.E.A.R.T. scoring
        setTimeout(callScoringAPI, 400);
      }
    }

    // ‚îÄ‚îÄ‚îÄ Show the next question (bot bubble + options) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderNextQuestion() {
      const q = questions[currentQuestionIndex];
      addBotBubble(q.text);
      renderOptions(q.options, q.key);
    }

    // ‚îÄ‚îÄ‚îÄ Once all four are answered, send them to /formester-webhook and show the result ‚îÄ
    async function callScoringAPI() {
      // Show ‚Äúloading‚Ä¶‚Äù line
      loadingIndicator.style.display = "block";

      try {
        const resp = await fetch("/formester-webhook", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(answers)
        });
        const data = await resp.json();
        loadingIndicator.style.display = "none";

        if (resp.ok && data.heart_scores) {
          addBotBubble("üìä Here are your H.E.A.R.T. scores:");
          // Show the raw GPT reply inside a <pre> block
          const pre = document.createElement("pre");
          pre.style.background = "#333";
          pre.style.color = "#FFF";
          pre.style.padding = "12px";
          pre.style.borderRadius = "4px";
          pre.style.whiteSpace = "pre-wrap";
          pre.style.fontSize = "13px";
          pre.innerText = data.heart_scores;
          chatWindow.appendChild(pre);
          chatWindow.scrollTop = chatWindow.scrollHeight;
        } else {
          addBotBubble("‚ö†Ô∏è Sorry, something went wrong. Please try again later.");
        }
      } catch (err) {
        loadingIndicator.style.display = "none";
        addBotBubble("‚ö†Ô∏è Network or server error. Please refresh and try again.");
        console.error(err);
      }
    }

    // ‚îÄ‚îÄ‚îÄ Kick things off by rendering question #1 after page load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    window.addEventListener("DOMContentLoaded", () => {
      renderNextQuestion();
    });
  </script>
</body>
</html>
