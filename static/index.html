<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Culture IQ H.E.A.R.T Assessment</title>

  <!-- 1) Pull in your Inter font from Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
    rel="stylesheet"
  />

  <style>
    /* â”€â”€â”€ Overall page styling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #000;        /* black background for â€œbolt.â€ brand */
      color: #FFF;                   /* white text */
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .container {
      background: #111;              /* slightly off-black container */
      border-radius: 8px;
      box-shadow: 0 0 16px rgba(0,0,0,0.4);
      padding: 24px;
      margin: 40px;
      width: 100%;
      max-width: 480px;
    }

    /* â”€â”€â”€ Heading & logo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    h1 {
      font-size: 24px;
      margin-bottom: 16px;
      text-align: center;
      color: #00AEEF;                /* bolt.-blue tagline color */
    }

    .logo {
      display: block;
      margin: 0 auto 16px auto;
      width: 120px;
      height: auto;
    }

    /* â”€â”€â”€ Chat window styling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chat-window {
      background: #222;              /* dark gray chat background */
      border-radius: 6px;
      padding: 16px;
      min-height: 320px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
    }

    .bubble {
      padding: 10px 14px;
      border-radius: 20px;
      max-width: 80%;
      font-size: 14px;
      line-height: 1.4;
      word-wrap: break-word;
    }

    .bot {
      background: #333;              /* darker bubble for bot */
      align-self: flex-start;
      color: #EEE;
    }

    .user {
      background: #005B9A;           /* bolt. navy-blue bubble for user */
      align-self: flex-end;
      color: #FFF;
    }

    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .option-btn {
      border: none;
      padding: 8px 12px;
      border-radius: 20px;
      cursor: pointer;
      background: #005B9A;           /* bolt. navy-blue buttons */
      color: #FFF;
      font-size: 14px;
    }

    .option-btn:hover {
      background: #00AEEF;           /* bolt. bright-blue hover */
    }

    #loading {
      display: none;
      margin-top: 10px;
      font-style: italic;
      color: #BBB;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- 1) The brand logo at the top -->
    <img
      src="/static/images/bolt_logo_white.png"
      alt="bolt. logo"
      class="logo"
    />

    <!-- 2) The new heading -->
    <h1>Culture IQ H.E.A.R.T Assessment</h1>

    <!-- 3) Chat window -->
    <div class="chat-window" id="chatWindow">
      <!-- Chat bubbles will be injected here by JavaScript -->
    </div>
    <div id="loading">Calculating your H.E.A.R.T. scoresâ€¦</div>
  </div>

  <script>
    // â”€â”€â”€ 1) The four questions & their emoji choices â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const questions = [
      {
        key: "work_feeling",
        text: "Which emoji best captures how you feel about your work right now?",
        options: [
          "ğŸ˜€ Energized",
          "ğŸ™‚ Okay",
          "ğŸ˜ Meh",
          "ğŸ˜“ Drained",
          "ğŸ˜¡ Frustrated"
        ]
      },
      {
        key: "team_feeling",
        text: "Which emoji best captures how you feel about your team?",
        options: [
          "ğŸ¤ Supported",
          "ğŸ˜” Alone",
          "ğŸ‘‚ Heard",
          "âŒ Dismissed",
          "ğŸ”’ Safe",
          "ğŸ¤¨ Judged",
          "ğŸ™Œ Encouraged",
          "ğŸ’¡ Valued"
        ]
      },
      {
        key: "leadership_feeling",
        text: "Which emoji best captures how you feel about leadership?",
        options: [
          "ğŸ”Š Clear",
          "ğŸ™ Distant",
          "ğŸ¯ Trustworthy",
          "â˜ï¸ Unclear",
          "âœ¨ Inspiring",
          "ğŸ¤¨ Rigid",
          "ğŸ˜“ Micromanaging",
          "ğŸ”’ Safe"
        ]
      },
      {
        key: "company_people_feeling",
        text: "Which emoji best captures how you feel about people at your company?",
        options: [
          "ğŸ¤— Included",
          "ğŸ˜’ Ignored",
          "â¤ï¸ Connected",
          "ğŸ¤ Respectful",
          "ğŸ¤” Suspicious",
          "ğŸšª Excluded",
          "ğŸ”’ Safe",
          "ğŸ˜“ Isolated"
        ]
      }
    ];

    // Store each answer here
    const answers = {};

    // Index of the question we are currently on:
    let currentQuestionIndex = 0;

    const chatWindow = document.getElementById("chatWindow");
    const loadingIndicator = document.getElementById("loading");

    // â”€â”€â”€ Utility: Add a â€œbotâ€ bubble with some text â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addBotBubble(text) {
      const bubble = document.createElement("div");
      bubble.className = "bubble bot";
      bubble.innerText = text;
      chatWindow.appendChild(bubble);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // â”€â”€â”€ Utility: Add a â€œuserâ€ bubble with the chosen answer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function addUserBubble(text) {
      const bubble = document.createElement("div");
      bubble.className = "bubble user";
      bubble.innerText = text;
      chatWindow.appendChild(bubble);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // â”€â”€â”€ Utility: Render the emojiâ€options buttons for the current question â”€
    function renderOptions(options, questionKey) {
      const container = document.createElement("div");
      container.className = "options";

      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "option-btn";
        btn.innerText = opt;
        btn.onclick = () => handleUserChoice(questionKey, opt);
        container.appendChild(btn);
      });

      chatWindow.appendChild(container);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // â”€â”€â”€ Handler when user picks one option â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function handleUserChoice(questionKey, chosenText) {
      // 1) Remove all existing option buttons (so user canâ€™t click again)
      document.querySelectorAll(".options").forEach(el => el.remove());

      // 2) Show the userâ€™s choice as a userâ€bubble
      addUserBubble(chosenText);

      // 3) Store it
      answers[questionKey] = chosenText;

      // 4) Move to the next question after a short delay:
      currentQuestionIndex++;
      if (currentQuestionIndex < questions.length) {
        setTimeout(renderNextQuestion, 400);
      } else {
        // All four answered; now call the backend for H.E.A.R.T. scoring
        setTimeout(callScoringAPI, 400);
      }
    }

    // â”€â”€â”€ Show the next question (bot bubble + options) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderNextQuestion() {
      const q = questions[currentQuestionIndex];
      addBotBubble(q.text);
      renderOptions(q.options, q.key);
    }

    // â”€â”€â”€ Once all four are answered, send them to /formester-webhook and show the result â”€
    async function callScoringAPI() {
      // Show â€œloadingâ€¦â€ line
      loadingIndicator.style.display = "block";

      try {
        const resp = await fetch("/formester-webhook", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(answers)
        });
        const data = await resp.json();
        loadingIndicator.style.display = "none";

        if (resp.ok && data.heart_scores) {
          addBotBubble("ğŸ“Š Here are your H.E.A.R.T. scores:");
          // Show the raw GPT reply inside a <pre> block
          const pre = document.createElement("pre");
          pre.style.background = "#333";
          pre.style.color = "#FFF";
          pre.style.padding = "12px";
          pre.style.borderRadius = "4px";
          pre.style.whiteSpace = "pre-wrap";
          pre.style.fontSize = "13px";
          pre.innerText = data.heart_scores;
          chatWindow.appendChild(pre);
          chatWindow.scrollTop = chatWindow.scrollHeight;
        } else {
          addBotBubble("âš ï¸ Sorry, something went wrong. Please try again later.");
        }
      } catch (err) {
        loadingIndicator.style.display = "none";
        addBotBubble("âš ï¸ Network or server error. Please refresh and try again.");
        console.error(err);
      }
    }

    // â”€â”€â”€ Kick things off by rendering question #1 after page load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.addEventListener("DOMContentLoaded", () => {
      renderNextQuestion();
    });
  </script>
</body>
</html>
