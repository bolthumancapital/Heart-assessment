<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>bolt. Conversational H.E.A.R.T. Assessment</title>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Brand‚ÄêFeel CSS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <style>
    /* 1) Use a clean, modern sans‚Äêserif. Later, you can replace "Helvetica Neue" with your exact bolt. brand font. */
    @import url('https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@300;400;600&display=swap');

    /* 2) Black page background to match bolt. dark theme */
    body {
      background-color: #000; 
      color: #fff; 
      font-family: 'Helvetica Neue', Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    /* 3) Centered container with a little padding */
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    /* 4) Header with bolt logo and title */
    header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    header img {
      height: 48px;
      margin-right: 12px;
    }
    header h1 {
      font-size: 24px;
      margin: 0;
      color: #fff;
    }

    /* 5) Chat window background slightly lighter than pure black */
    .chat-window {
      background-color: #111; 
      border-radius: 8px;
      padding: 16px;
      min-height: 360px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      overflow-y: auto;
    }

    /* 6) Chat bubbles */
    .bubble {
      padding: 12px 16px;
      border-radius: 20px;
      max-width: 80%;
      line-height: 1.4;
      word-break: break-word;
    }
    .bot {
      background: #1a1a1a;   /* very dark gray */
      color: #e0e0e0;        /* light gray text */
      align-self: flex-start;
    }
    .user {
      background: #007bff;   /* bolt blue */
      color: #fff;
      align-self: flex-end;
    }

    /* 7) Emoji‚Äêoption buttons */
    .options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    .option-btn {
      background: #222;          /* dark button */
      color: #fff;
      border: 1px solid #333;
      border-radius: 20px;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .option-btn:hover {
      background: #007bff;       /* on hover, switch to bolt blue */
      border-color: #0056b3;
    }

    /* 8) Loading indicator text */
    #loading {
      display: none;
      margin-top: 12px;
      font-style: italic;
      color: #ccc;
    }

    /* 9) Pre block for showing the raw H.E.A.R.T. response */
    pre {
      background: #222;
      color: #e0e0e0;
      padding: 12px;
      border-radius: 6px;
      white-space: pre-wrap;
      margin-top: 12px;
      overflow-x: auto;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- ‚îÄ‚îÄ‚îÄ Header: bolt logo + title ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <header>
      <!-- Ensure this path matches where you stored your logo under static/images/ -->
      <img src="/static/images/bolt_logo_white.png" alt="bolt. logo" />
      <h1>bolt. H.E.A.R.T. Assessment</h1>
    </header>

    <!-- ‚îÄ‚îÄ‚îÄ Chat Window ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div class="chat-window" id="chatWindow">
      <!-- bubbles will be injected here by JavaScript -->
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ Loading Indicator ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
    <div id="loading">Calculating your H.E.A.R.T. scores‚Ä¶</div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <!-- ‚îÄ‚îÄ‚îÄ Conversational JavaScript ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <script>
    // 1) Define the four questions and their emoji‚Äêoptions
    const questions = [
      {
        key: "work_feeling",
        text: "Which emoji best captures how you feel about your work right now?",
        options: [
          "üòÄ Energized",
          "üôÇ Okay",
          "üòê Meh",
          "üòì Drained",
          "üò° Frustrated"
        ]
      },
      {
        key: "team_feeling",
        text: "Which emoji best captures how you feel about your team?",
        options: [
          "ü§ù Supported",
          "üòî Alone",
          "üëÇ Heard",
          "‚ùå Dismissed",
          "üîí Safe",
          "ü§® Judged",
          "üôå Encouraged",
          "üí° Valued"
        ]
      },
      {
        key: "leadership_feeling",
        text: "Which emoji best captures how you feel about leadership?",
        options: [
          "üîä Clear",
          "üôÅ Distant",
          "üéØ Trustworthy",
          "‚òÅÔ∏è Unclear",
          "‚ú® Inspiring",
          "ü§® Rigid",
          "üòì Micromanaging",
          "üîí Safe"
        ]
      },
      {
        key: "company_people_feeling",
        text: "Which emoji best captures how you feel about people at your company?",
        options: [
          "ü§ó Included",
          "üòí Ignored",
          "‚ù§Ô∏è Connected",
          "ü§ù Respectful",
          "ü§î Suspicious",
          "üö™ Excluded",
          "üîí Safe",
          "üòì Isolated"
        ]
      }
    ];

    // 2) An object to hold the user‚Äôs answers
    const answers = {};

    // 3) Track which question we‚Äôre on
    let currentQuestionIndex = 0;

    // 4) Grab references to our DOM nodes
    const chatWindow      = document.getElementById("chatWindow");
    const loadingIndicator = document.getElementById("loading");

    // ‚îÄ‚îÄ‚îÄ Utility: Add a ‚Äúbot‚Äù chat bubble ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function addBotBubble(text) {
      const bubble = document.createElement("div");
      bubble.className = "bubble bot";
      bubble.innerText = text;
      chatWindow.appendChild(bubble);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // ‚îÄ‚îÄ‚îÄ Utility: Add a ‚Äúuser‚Äù chat bubble ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function addUserBubble(text) {
      const bubble = document.createElement("div");
      bubble.className = "bubble user";
      bubble.innerText = text;
      chatWindow.appendChild(bubble);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // ‚îÄ‚îÄ‚îÄ Utility: Render option buttons under a chat bubble ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderOptions(options, questionKey) {
      const container = document.createElement("div");
      container.className = "options";
      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "option-btn";
        btn.innerText = opt;
        btn.onclick = () => handleUserChoice(questionKey, opt);
        container.appendChild(btn);
      });
      chatWindow.appendChild(container);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // ‚îÄ‚îÄ‚îÄ Handler: User picks an emoji option ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function handleUserChoice(questionKey, chosenText) {
      // 1) Remove any existing option‚Äêbuttons so they can‚Äôt be clicked again
      document.querySelectorAll(".options").forEach(el => el.remove());
      // 2) Show the selected choice as a ‚Äúuser‚Äù bubble
      addUserBubble(chosenText);
      // 3) Save the answer
      answers[questionKey] = chosenText;
      // 4) Move to next question (or finish)
      currentQuestionIndex++;
      if (currentQuestionIndex < questions.length) {
        setTimeout(renderNextQuestion, 400);
      } else {
        // All questions answered ‚Üí call backend
        setTimeout(callScoringAPI, 400);
      }
    }

    // ‚îÄ‚îÄ‚îÄ Show the next question‚Äôs text and options ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function renderNextQuestion() {
      const q = questions[currentQuestionIndex];
      addBotBubble(q.text);
      renderOptions(q.options, q.key);
    }

    // ‚îÄ‚îÄ‚îÄ After answering all four, send them to /formester-webhook ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function callScoringAPI() {
      loadingIndicator.style.display = "block";  // show loading‚Ä¶
      try {
        const resp = await fetch("/formester-webhook", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(answers)
        });
        const data = await resp.json();
        loadingIndicator.style.display = "none"; // hide loading

        if (resp.ok && data.response) {
          // 1) Show a heading bubble
          addBotBubble("üìä Here are your H.E.A.R.T. scores:");
          // 2) Create a <pre> block to show the raw GPT reply
          const pre = document.createElement("pre");
          pre.innerText = data.response;
          chatWindow.appendChild(pre);
        } else {
          addBotBubble("‚ö†Ô∏è Sorry, something went wrong. Please try again later.");
        }
      } catch (err) {
        loadingIndicator.style.display = "none";
        addBotBubble("‚ö†Ô∏è Network or server error. Please refresh and try again.");
        console.error(err);
      }
    }

    // ‚îÄ‚îÄ‚îÄ Kick things off once the page finishes loading ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    window.addEventListener("DOMContentLoaded", () => {
      renderNextQuestion();
    });
  </script>
</body>
</html>
